<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Option Pricing Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --card-bg: #f8f9fa;
      --input-bg: #ffffff;
      --border-color: #ccc;
    }

    .dark-mode {
      --bg-color: #121212;
      --text-color: #ffffff;
      --card-bg: #1e1e1e;
      --input-bg: #2c2c2c;
      --border-color: #555;
    }

    html,
    body,
    .container-fluid,
    footer {
      background-color: var(--bg-color) !important;
      color: var(--text-color) !important;
      transition: all 0.3s ease;
    }

    footer {
      background-color: var(--card-bg) !important;
      color: var(--text-color) !important;
      padding: 1rem;
    }

    .form-control,
    .form-select,
    .btn {
      background-color: var(--input-bg) !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
      transition: all 0.3s ease;
    }

    label,
    .form-check-label {
      color: var(--text-color) !important;
    }

    img {
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
      max-width: 100%;
    }

    .toggle-container {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 1000;
      padding: 8px 12px;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .toggle-container:hover {
      opacity: 0.5;
    }

    .sidebar {
      width: 300px;
      background-color: var(--card-bg);
      padding: 20px;
      transition: transform 0.3s ease;
      transform: translateX(0);
      position: fixed;
      height: 100vh;
      top: 0;
      left: 0;
      overflow-y: auto;
      z-index: 1000;
    }

    .sidebar.hidden {
      transform: translateX(-320px);
    }

    #toggleSidebarBtn {
      position: fixed;
      top: 10px;
      left: 300px;
      z-index: 1100;
      transition: left 0.3s ease;
    }

    .sidebar.hidden+#toggleSidebarBtn {
      left: 0;
    }

    #page-content-wrapper {
      margin-left: 300px;
      transition: margin-left 0.3s ease;
      padding: 20px;
    }

    .sidebar.hidden~#page-content-wrapper {
      margin-left: 0;
    }

    /* Scrollbar Styling for Sidebar */
    .sidebar::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: var(--card-bg);
      border-radius: 10px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background-color: var(--border-color);
      border-radius: 10px;
      border: 2px solid var(--card-bg);
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background-color: #888;
    }

    /* Firefox */
    .sidebar {
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) var(--card-bg);
    }
    .price-card {
  background-color: var(--card-bg);
  border: 2px solid var(--border-color);
  transition: all 0.3s ease;
}

.call-card:hover {
  border-color: #28a745;
  background-color: rgba(40, 167, 69, 0.1);
}

.put-card:hover {
  border-color: #dc3545;
  background-color: rgba(220, 53, 69, 0.1);
}

.price-card h5 {
  font-weight: 600;
}

.price-card h4 {
  font-size: 1.75rem;
}

  </style>
</head>

<body>
  <div class="toggle-container">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="themeSwitch" />
      <label class="form-check-label" for="themeSwitch" id="themeLabel">üåô Dark Mode</label>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <h4 class="mb-3">Option Parameters</h4>
    <form method="POST" class="row g-3">
      <div class="form-section">
        <label>Stock Price (S)</label>
        <input class="form-control" name="S" required />
      </div>
      <div class="form-section">
        <label>Strike Price (K)</label>
        <input class="form-control" name="K" required />
      </div>
      <div class="form-section">
        <label>Time to Maturity (T in years)</label>
        <input class="form-control" name="T" required />
      </div>
      <div class="form-section">
        <label>Risk-Free Rate (r)</label>
        <input class="form-control" name="r" required />
      </div>
      <div class="form-section">
        <label>Volatility (œÉ)</label>
        <input class="form-control" name="sigma" required />
      </div>

      <div id="heston-params" style="display: none">
        <label>Œ∫ (Mean Reversion Rate)</label>
        <input type="number" step="0.01" class="form-control" name="kappa" value="1.5" />
        <label>Œ∏ (Long-run Variance)</label>
        <input type="number" step="0.01" class="form-control" name="theta" value="0.04" />
        <label>œÉ (Volatility of Volatility)</label>
        <input type="number" step="0.01" class="form-control" name="sigma_h" value="0.3" />
        <label>œÅ (Correlation)</label>
        <input type="number" step="0.01" class="form-control" name="rho" value="-0.7" />
        <label>v‚ÇÄ (Initial Variance)</label>
        <input type="number" step="0.01" class="form-control" name="v0" value="0.04" />
      </div>
      <div class="form-section">
        <label>Pricing Model</label>
        <select class="form-select" name="model" id="model-select">
          <option value="binomial">Binomial Tree</option>
          <option value="black_scholes">Black-Scholes</option>
          <option value="heston">Heston</option>
        </select>
      </div>
      <div class="form-section" id="steps-container">
        <label>Number of Steps (for Binomial only)</label>
        <input type="number" class="form-control" name="steps" value="100" min="1" />
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="show_heatmap" id="show_heatmap" />
        <label class="form-check-label" for="show_heatmap">
          Show Heatmap (Only for Black-Scholes and Heston)
        </label>
      </div>
      <button type="submit" class="btn btn-primary mt-2">Calculate</button>
    </form>
  </div>

  <div id="toggleSidebarBtn" class="btn btn-secondary btn-sm">‚ùå</div>

  <div id="page-content-wrapper">
    <h2 id="current-model-heading" class="mb-3 text-center">Currently Selected Model: Black-Scholes</h2>

    {% if call_price is not none and put_price is not none %}
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="price-card call-card shadow-sm p-3 rounded text-center">
          <h5 class="text-success mb-2">üìà Call Option Price</h5>
          <h4 class="fw-bold">‚Çπ{{ call_price }}</h4>
        </div>
      </div>
      <div class="col-md-6">
        <div class="price-card put-card shadow-sm p-3 rounded text-center">
          <h5 class="text-danger mb-2">üìâ Put Option Price</h5>
          <h4 class="fw-bold">‚Çπ{{ put_price }}</h4>
        </div>
      </div>
    </div>
    {% endif %}
    {% if plot_path %}
    <h5 class="text-center">Option Price vs Steps (Binomial)</h5>
    <img src="{{ plot_path }}" class="img-fluid w-100" alt="Option Price Plot" />
    {% endif %}

    {% if bs_plot_path %}
    <h5 class="text-center">Option Price vs Stock Price (Black-Scholes)</h5>
    <img src="{{ bs_plot_path }}" class="img-fluid w-100" alt="BS Plot" />
    {% endif %}

    {% if heatmap_path %}
    <h5 class="text-center">Option Price Heatmap</h5>
    <img src="{{ heatmap_path }}" class="img-fluid w-100" alt="Heatmap" />
    {% endif %}

    {% if s_plot_path %}
    <h5 class="text-center">Option Price vs Stock Price (Heston)</h5>
    <img src="{{ s_plot_path }}" class="img-fluid w-100" alt="Heston S" />
    {% endif %}

    {% if rho_plot_path %}
    <h5 class="text-center">Option Price vs Correlation (œÅ)</h5>
    <img src="{{ rho_plot_path }}" class="img-fluid w-100" alt="Heston Rho" />
    {% endif %}
  </div>

  <footer class="text-center">Made by NS</footer>

  <script>
    const switchInput = document.getElementById("themeSwitch");
    const themeLabel = document.getElementById("themeLabel");
    const savedTheme = localStorage.getItem("theme");
    const useDark = savedTheme === "dark";

    if (useDark) {
      document.body.classList.add("dark-mode");
      switchInput.checked = true;
      themeLabel.textContent = "‚òÄÔ∏è Light Mode";
    } else {
      document.body.classList.remove("dark-mode");
      switchInput.checked = false;
      themeLabel.textContent = "üåô Dark Mode";
    }

    switchInput.addEventListener("change", () => {
      const isDark = switchInput.checked;
      document.body.classList.toggle("dark-mode", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      themeLabel.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    });

    const toggleBtn = document.getElementById("toggleSidebarBtn");
    const sidebar = document.getElementById("sidebar");
    const content = document.getElementById("page-content-wrapper");

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      toggleBtn.textContent = sidebar.classList.contains("hidden") ? "‚ò∞" : "‚ùå";
    });

    const modelSelect = document.getElementById("model-select");
    const stepsContainer = document.getElementById("steps-container");
    const hestonParams = document.getElementById("heston-params");

    function toggleModelInputs() {
      const model = modelSelect.value;
      stepsContainer.style.display = model === "binomial" ? "block" : "none";
      hestonParams.style.display = model === "heston" ? "block" : "none";
    }
    function toggleModelInputs() {
      const model = modelSelect.value;
      stepsContainer.style.display = model === "binomial" ? "block" : "none";
      hestonParams.style.display = model === "heston" ? "block" : "none";

      // Update model heading
      const modelNameMap = {
        binomial: "Binomial Tree",
        black_scholes: "Black-Scholes",
        heston: "Heston"
      };
      document.getElementById("current-model-heading").textContent =
        "Currently Selected Model: " + modelNameMap[model];
    }


    modelSelect.addEventListener("change", toggleModelInputs);
    window.onload = toggleModelInputs;
  </script>
</body>

</html>