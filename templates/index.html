<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Option Pricing Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4">Option Pricing Calculator</h2>
    <form method="POST" class="row g-3">
      <div class="col-md-4"><label class="form-label">Stock Price (S)</label><input class="form-control" name="S" required></div>
      <div class="col-md-4"><label class="form-label">Strike Price (K)</label><input class="form-control" name="K" required></div>
      <div class="col-md-4"><label class="form-label">Time to Maturity (T in years)</label><input class="form-control" name="T" required></div>
      <div class="col-md-4"><label class="form-label">Risk-Free Rate (r)</label><input class="form-control" name="r" required></div>
      <div class="col-md-4"><label class="form-label">Volatility (σ)</label><input class="form-control" name="sigma" required></div>
      <div id="heston-params" style="display: none;">
        <div class="row mt-3">
          <div class="col-md-4">
            <label class="form-label">κ (Mean Reversion Rate)</label>
            <input type="number" step="0.01" class="form-control" name="kappa" value="1.5">
          </div>
        <div class="col-md-4">
          <label class="form-label">θ (Long-run Variance)</label>
          <input type="number" step="0.01" class="form-control" name="theta" value="0.04">
        </div>
        <div class="col-md-4">
          <label class="form-label">σ (Volatility of Volatility)</label>
          <input type="number" step="0.01" class="form-control" name="sigma_h" value="0.3">
        </div>
        <div class="col-md-4">
          <label class="form-label">ρ (Correlation)</label>
          <input type="number" step="0.01" class="form-control" name="rho" value="-0.7">
        </div>
        <div class="col-md-4">
          <label class="form-label">v₀ (Initial Variance)</label>
          <input type="number" step="0.01" class="form-control" name="v0" value="0.04">
        </div>
      </div>
    </div>

      <div class="col-md-4">
        <label class="form-label">Option Type</label>
        <select class="form-select" name="option_type">
          <option value="call">Call</option>
          <option value="put">Put</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Pricing Model</label>
        <select class="form-select" name="model" id="model-select">
          <option value="binomial">Binomial Tree</option>
          <option value="black_scholes">Black-Scholes</option>
          <option value="heston">Heston</option>
        </select>
      </div>
      <div class="col-md-4" id="steps-container">
        <label class="form-label">Number of Steps (for Binomial only)</label>
        <input type="number" class="form-control" name="steps" value="100" min="1">
      </div>
      <div class="form-check mt-3">
  <input class="form-check-input" type="checkbox" name="show_heatmap" id="show_heatmap">
  <label class="form-check-label" for="show_heatmap">
    Show Heatmap (Only for Black-Scholes)
  </label>
</div>

      <div class="col-12">
        <button type="submit" class="btn btn-primary">Calculate</button>
      </div>
    </form>

    {% if result is not none %}
      <div class="alert alert-success mt-4">
        Option Price: ₹{{ result }}
      </div>
    {% endif %}

    {% if plot_path %}
      <div class="container-fluid mt-4">
        <h5 class="text-center">Option Price vs Steps (Binomial)</h5>
        <img src="{{ plot_path }}" class="img-fluid w-100" alt="Option Price Plot">
      </div>
    {% endif %}

    {% if bs_plot_path %}
    <div class="container-fluid mt-4">
      <h5 class="text-center">Option Price vs Stock Price (Black-Scholes)</h5>
      <img src="{{ bs_plot_path }}" class="img-fluid w-100" alt="BS plot">
    </div>
    {% endif %}
    {% if heatmap_path %}
<div class="container-fluid mt-5">
  <h5 class="text-center">Option Price Heatmap (Black-Scholes)</h5>
  <img src="{{ heatmap_path }}" class="img-fluid w-100" alt="Heatmap">
</div>
{% endif %}
{% if s_plot_path %}
<div class="container-fluid mt-5">
  <h5 class="text-center">Option Price vs Stock Price (Heston)</h5>
  <img src="{{ s_plot_path }}" class="img-fluid w-100" alt="Heston vs S">
</div>
{% endif %}

{% if rho_plot_path %}
<div class="container-fluid mt-5">
  <h5 class="text-center">Option Price vs Correlation (ρ)</h5>
  <img src="{{ rho_plot_path }}" class="img-fluid w-100" alt="Heston vs rho">
</div>
{% endif %}


  </div>

  <script>
  const modelSelect = document.getElementById('model-select');
  const stepsContainer = document.getElementById('steps-container');
  const hestonParams = document.getElementById('heston-params');

  function toggleModelInputs() {
    const model = modelSelect.value;

    // Show/hide steps for binomial
    stepsContainer.style.display = (model === 'binomial') ? 'block' : 'none';

    // Show/hide Heston parameters
    hestonParams.style.display = (model === 'heston') ? 'block' : 'none';
  }

  modelSelect.addEventListener('change', toggleModelInputs);
  window.onload = toggleModelInputs;  // run once when page loads
</script>

</body>
</html>
