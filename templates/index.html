<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="{{ url_for('static', filename='download.png') }}" type="image/png">
  <title>Option Pricing Calculator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --card-bg: #f8f9fa;
      --input-bg: #ffffff;
      --border-color: #ccc;
    }

    .dark-mode {
      --bg-color: #121212;
      --text-color: #ffffff;
      --card-bg: #1e1e1e;
      --input-bg: #2c2c2c;
      --border-color: #555;
    }

    html,
    body,
    .container-fluid {
      background-color: var(--bg-color) !important;
      color: var(--text-color) !important;
      transition: all 0.3s ease;
    }

    footer {
      background-color: var(--card-bg) !important;
      color: var(--text-color) !important;
      padding: 1rem;
      text-align: center;
      transition: margin-left 0.3s ease;
    }

    .form-control,
    .form-select,
    .btn {
      background-color: var(--input-bg) !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
      transition: all 0.3s ease;
    }

    label,
    .form-check-label {
      color: var(--text-color) !important;
    }

    img {
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
      max-width: 100%;
    }

    .toggle-container {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 1000;
      padding: 8px 12px;
      border-radius: 8px;
      background-color: var(--card-bg);
      color: var(--text-color);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .toggle-container:hover {
      opacity: 0.5;
    }

    .sidebar {
      width: 300px;
      background-color: var(--card-bg);
      padding: 20px;
      transition: transform 0.3s ease;
      transform: translateX(0);
      position: fixed;
      height: 100vh;
      top: 0;
      left: 0;
      overflow-y: auto;
      z-index: 1000;

      /* Firefox Scroll */
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) var(--card-bg);
    }

    /* Sidebar Hidden */
    .sidebar.hidden {
      transform: translateX(-320px);
    }

    /* Toggle Button */
    #toggleSidebarBtn {
      position: fixed;
      top: 10px;
      left: 300px;
      z-index: 1100;
      transition: left 0.3s ease;
    }

    .sidebar.hidden+#toggleSidebarBtn {
      left: 0;
    }

    /* Main Content Wrapper */
    #main-content-wrapper {
      margin-left: 300px;
      transition: margin-left 0.3s ease;
    }

    .sidebar.hidden~#main-content-wrapper {
      margin-left: 0;
    }

    /* Scrollbar Styling for Sidebar */
    .sidebar::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: var(--card-bg);
      border-radius: 10px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background-color: var(--border-color);
      border-radius: 10px;
      border: 2px solid var(--card-bg);
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background-color: #888;
    }

    /* Price Cards */
    .price-card {
      background-color: var(--card-bg);
      border: 2px solid var(--border-color);
      transition: all 0.3s ease;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .call-card:hover {
      border-color: #28a745;
      background-color: rgba(40, 167, 69, 0.1);
    }

    .put-card:hover {
      border-color: #dc3545;
      background-color: rgba(220, 53, 69, 0.1);
    }

    .price-card h5 {
      font-weight: 600;
    }

    .price-card h4 {
      font-size: 1.75rem;
      margin-top: 0.5rem;
    }

    /* Footer Links */
    footer a {
      color: var(--text-color);
      margin: 0 8px;
      text-decoration: none;
    }

    footer a:hover {
      opacity: 0.7;
    }

    .plot-image {
      max-width: 80%;
      height: auto;
      display: block;
      margin: 20px auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }
    .loader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 255, 255, 0.75);
  z-index: 2000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: 1.2rem;
  color: var(--text-color);
  transition: all 0.3s ease;
}

.dark-mode .loader-overlay {
  background-color: rgba(18, 18, 18, 0.75);
}

.d-none {
  display: none !important;
}

  </style>
</head>

<body>
  <div class="toggle-container">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="themeSwitch" />
      <label class="form-check-label" for="themeSwitch" id="themeLabel">üåô Dark Mode</label>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <h4 class="mb-3">Option Parameters</h4>
    <form method="POST" class="row g-3">
      <div class="form-section">
        <label>Stock Price (S)</label>
        <input class="form-control" name="S" required value="{{ form_data['S'] }}" />
      </div>
      <div class="form-section">
        <label>Strike Price (K)</label>
        <input class="form-control" name="K" required value="{{ form_data['K'] }}" />
      </div>
      <div class="form-section">
        <label>Time to Maturity (T in years)</label>
        <input class="form-control" name="T" required value="{{ form_data['T'] }}" />
      </div>
      <div class="form-section">
        <label>Risk-Free Rate (r)</label>
        <input class="form-control" name="r" required value="{{ form_data['r'] }}" />
      </div>
      <div class="form-section">
        <label>Volatility (œÉ)</label>
        <input class="form-control" name="sigma" required value="{{ form_data['sigma'] }}" />
      </div>

      <div id="heston-params" style="display: none">
        <label>Œ∫ (Mean Reversion Rate)</label>
        <input type="number" step="0.01" class="form-control" name="kappa" value="1.5" />
        <label>Œ∏ (Long-run Variance)</label>
        <input type="number" step="0.01" class="form-control" name="theta" value="0.04" />
        <label>œÉ (Volatility of Volatility)</label>
        <input type="number" step="0.01" class="form-control" name="sigma_h" value="0.3" />
        <label>œÅ (Correlation)</label>
        <input type="number" step="0.01" class="form-control" name="rho" value="-0.7" />
        <label>v‚ÇÄ (Initial Variance)</label>
        <input type="number" step="0.01" class="form-control" name="v0" value="0.04" />
      </div>
      <div class="form-section">
        <label>Pricing Model</label>
        <select class="form-select" name="model" id="model-select">
          <option value="binomial">Binomial Tree</option>
          <option value="black_scholes">Black-Scholes</option>
          <option value="heston">Heston</option>
        </select>
      </div>
      <div class="form-section" id="steps-container">
        <label>Number of Steps (for Binomial only)</label>
        <input type="number" class="form-control" name="steps" value="100" min="1" />
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="show_heatmap" id="show_heatmap" />
        <label class="form-check-label" for="show_heatmap">
          Show Heatmap (Only for Black-Scholes and Heston)
        </label>
      </div>
      <button type="submit" class="btn btn-primary mt-2">Calculate</button>
    </form>
  </div>

  <div id="toggleSidebarBtn" class="btn btn-secondary btn-sm">‚ùå</div>
  <div id="main-content-wrapper">
    <div id="page-content-wrapper">
      <h2 id="current-model-heading" class="mb-3 text-center">Currently Selected Model: Black-Scholes</h2>

      {% if call_price is not none and put_price is not none %}
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="price-card call-card shadow-sm p-3 rounded text-center">
            <h5 class="text-success mb-2">üìà Call Option Price</h5>
            <h4 class="fw-bold">‚Çπ{{ call_price }}</h4>
          </div>
        </div>
        <div class="col-md-6">
          <div class="price-card put-card shadow-sm p-3 rounded text-center">
            <h5 class="text-danger mb-2">üìâ Put Option Price</h5>
            <h4 class="fw-bold">‚Çπ{{ put_price }}</h4>
          </div>
        </div>
      </div>
      {% endif %}
      {% if plot_path %}
      <h5 class="text-center">Option Price vs Steps (Binomial)</h5>
      <img src="{{ plot_path }}" class="plot-image" alt="Option Price Plot" />
      {% endif %}

      {% if bs_plot_path %}
      <h5 class="text-center">Option Price vs Stock Price (Black-Scholes)</h5>
      <img src="{{ bs_plot_path }}" class="plot-image" alt="BS Plot" />
      {% endif %}

      {% if heatmap_path %}
      <h5 class="text-center">Option Price Heatmap</h5>
      <img src="{{ heatmap_path }}" class="plot-image" alt="Heatmap" />
      {% endif %}

      {% if s_plot_path %}
      <h5 class="text-center">Option Price vs Stock Price (Heston)</h5>
      <img src="{{ s_plot_path }}" class="plot-image" alt="Heston S" />
      {% endif %}

      {% if rho_plot_path %}
      <h5 class="text-center">Option Price vs Correlation (œÅ)</h5>
      <img src="{{ rho_plot_path }}" class="plot-image" alt="Heston Rho" />
      {% endif %}
    </div>
    <div id="formLoader" class="loader-overlay d-none">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p id="loaderText">Processing...</p>
</div>

    <footer class="text-center mt-4">
      Made by NS &nbsp;
      <a href="https://www.linkedin.com/in/nitin-shekhar" target="_blank">
        <i class="fab fa-linkedin fa-lg me-2"></i>
      </a>
      <a href="https://github.com/shekharnitin" target="_blank">
        <i class="fab fa-github fa-lg"></i>
      </a>
    </footer>
  </div>





  <script>
    const switchInput = document.getElementById("themeSwitch");
    const themeLabel = document.getElementById("themeLabel");
    const savedTheme = localStorage.getItem("theme");
    const useDark = savedTheme === "dark";

    if (useDark) {
      document.body.classList.add("dark-mode");
      switchInput.checked = true;
      themeLabel.textContent = "‚òÄÔ∏è Light Mode";
    } else {
      document.body.classList.remove("dark-mode");
      switchInput.checked = false;
      themeLabel.textContent = "üåô Dark Mode";
    }

    switchInput.addEventListener("change", () => {
      const isDark = switchInput.checked;
      document.body.classList.toggle("dark-mode", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      themeLabel.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    });

    const toggleBtn = document.getElementById("toggleSidebarBtn");
    const sidebar = document.getElementById("sidebar");
    const content = document.getElementById("page-content-wrapper");

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      toggleBtn.textContent = sidebar.classList.contains("hidden") ? "‚ò∞" : "‚ùå";
    });

  const form = document.querySelector("form");
  const heatmapCheckbox = document.getElementById("show_heatmap");
  const loader = document.getElementById("formLoader");
  const loaderText = document.getElementById("loaderText");

  form.addEventListener("submit", () => {
    if (heatmapCheckbox && heatmapCheckbox.checked) {
      loaderText.textContent = "Generating Heatmap...";
    } else {
      loaderText.textContent = "Calculating Option Prices...";
    }
    loader.classList.remove("d-none");
  });



    const modelSelect = document.getElementById("model-select");
    const stepsContainer = document.getElementById("steps-container");
    const hestonParams = document.getElementById("heston-params");

    function toggleModelInputs() {
      const model = modelSelect.value;
      stepsContainer.style.display = model === "binomial" ? "block" : "none";
      hestonParams.style.display = model === "heston" ? "block" : "none";
    }
    function toggleModelInputs() {
      const model = modelSelect.value;
      stepsContainer.style.display = model === "binomial" ? "block" : "none";
      hestonParams.style.display = model === "heston" ? "block" : "none";

      // Update model heading
      const modelNameMap = {
        binomial: "Binomial Tree",
        black_scholes: "Black-Scholes",
        heston: "Heston"
      };
      document.getElementById("current-model-heading").textContent =
        "Currently Selected Model: " + modelNameMap[model];
    }


    modelSelect.addEventListener("change", toggleModelInputs);
    window.onload = toggleModelInputs;
  </script>
</body>

</html>